#include "lqr.h"
#include "math.h"

/** LQR **/
// 初始化K矩阵
float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
float joint_K_L[6] = {0, 0, 0, 0, 0, 0};

float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-138.563695f,190.708389f,-132.260124f,-1.177617f},
        {-8.016347f,7.570002f,-14.657771f,-0.582522f},

        {-58.357658f,58.822209f,-19.623376f,-7.827021f},
        {-22.356965f,22.544263f,-8.758260f,-8.243990f},

        {-596.249377f,865.681399f,-491.876988f,111.420879f},
        {-12.450426f,22.336533f,-15.376747f,7.290957f}
};float joint_fitting_factor[6][4] = {
        {444.714161f,-438.682050f,143.020872f,10.338565f},
        {29.924082f,-25.010267f,-2.412428f,2.545640f},

        {-92.440557f,138.999613f,-78.826443f,14.225986f},
        {-147.886132f,184.702272f,-90.070097f,14.859463f},

        {2223.146002f,-2326.056787f,862.458481f,116.990433f},
        {116.697421f,-132.388483f,57.398882f,1.104709f}
};

/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}