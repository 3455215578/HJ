#include "lqr.h"
#include "math.h"

/** LQR **/
// 初始化K矩阵
float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
float joint_K_L[6] = {0, 0, 0, 0, 0, 0};

float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-122.539482f,174.691614f,-131.505301f,-1.627519f},
        {-6.149432f,5.181531f,-15.285984f,-0.621817f},

        {-48.919079f,51.005384f,-17.629747f,-10.222475f},
        {-6.386646f,7.804460f,-4.835141f,-9.836673f},

        {-352.461955f,542.171235f,-329.442444f,85.595980f},
        {-11.860799f,19.820453f,-13.127165f,7.142587f}
};float joint_fitting_factor[6][4] = {
        {462.442658f,-467.170132f,158.185011f,9.580402f},
        {34.060791f,-30.613553f,-0.286386f,2.460741f},

        {-59.741979f,114.057298f,-75.744664f,14.860247f},
        {-122.125260f,161.902846f,-84.790220f,14.701713f},

        {1539.802032f,-1664.663450f,653.950301f,80.341753f},
        {97.211752f,-114.668255f,52.502165f,0.252406f}
};
/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}
