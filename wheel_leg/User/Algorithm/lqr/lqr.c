#include "lqr.h"
#include "math.h"

/** LQR **/
// 初始化K矩阵
float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
float joint_K_L[6] = {0, 0, 0, 0, 0, 0};

float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-150.321356f,200.732243f,-138.580609f,-1.351191f},
        {-9.467797f,8.257936f,-16.096596f,-0.599006f},

        {-73.693049f,72.863306f,-23.615884f,-9.730281f},
        {-24.768569f,23.811062f,-9.066526f,-9.554901f},

        {-701.543218f,971.299640f,-524.700552f,113.548694f},
        {-22.709177f,35.302528f,-21.241912f,8.480007f}
};float joint_fitting_factor[6][4] = {
        {439.913049f,-427.103745f,133.509184f,11.283432f},
        {31.900575f,-26.407162f,-3.230740f,2.671082f},

        {-134.355180f,190.810452f,-102.402320f,17.354133f},
        {-186.532169f,227.441970f,-107.363905f,16.804774f},

        {2356.069843f,-2432.559096f,885.189594f,117.068665f},
        {152.755129f,-168.319164f,69.415950f,1.585710f}
};
/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}
