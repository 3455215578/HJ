#include "lqr.h"
#include "math.h"

// 初始化K矩阵
float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
float joint_K_L[6] = {0, 0, 0, 0, 0, 0};

float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-115.015570f,150.811623f,-90.385399f,-0.683845f},
        {-2.961175f,3.934224f,-6.074763f,-0.252076f},

        {-3.197913f,2.994897f,-0.912153f,-0.770101f},
        {-4.585014f,4.245380f,-1.343306f,-1.832575f},

        {-1560.279813f,1753.178328f,-751.049746f,122.776898f},
        {-28.079548f,33.933430f,-17.010394f,5.064552f}
};float joint_fitting_factor[6][4] = {
        {258.977305f,-263.622791f,101.677280f,7.728395f},
        {4.739531f,-1.272110f,-4.793368f,1.251058f},

        {-27.388500f,30.412116f,-12.660277f,1.778826f},
        {-66.806639f,73.128794f,-29.955460f,4.144668f},

        {3129.744241f,-3030.664276f,1001.402362f,547.097076f},
        {25.711759f,-32.151577f,18.367651f,12.656690f}
};

/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}