#include "lqr.h"
#include "math.h"

// 初始化K矩阵
float wheel_K_L[6] = {0, 0, 0, 0, 0, 0};
float joint_K_L[6] = {0, 0, 0, 0, 0, 0};

float wheel_K_R[6] = {0, 0, 0, 0, 0, 0};
float joint_K_R[6] = {0, 0, 0, 0, 0, 0};

// K拟合系数矩阵
float wheel_fitting_factor[6][4] = {
        {-180.128775f,224.401180f,-139.003572f,-0.093513f},
        {-9.718106f,8.949069f,-14.856590f,-0.143007f},

        {-73.127694f,66.874031f,-19.362594f,-8.209220f},
        {-49.589597f,44.528163f,-14.217075f,-7.527445f},

        {-2568.054756f,2918.121091f,-1249.704742f,189.518497f},
        {-44.300525f,55.407893f,-27.380095f,8.304001f}
};float joint_fitting_factor[6][4] = {
        {314.132566f,-300.671491f,93.604539f,10.136978f},
        {25.116916f,-20.663557f,-3.491195f,1.588599f},

        {-255.367230f,285.537094f,-118.590711f,15.388693f},
        {-237.748535f,261.755785f,-107.900778f,13.868445f},

        {3958.282632f,-3767.171439f,1200.715310f,300.167031f},
        {145.325564f,-150.778294f,58.573076f,5.365314f}
};

/** 拟合K **/
void chassis_K_matrix_fitting(float L0, float K[6], const float KL[6][4]) {
    for (int i = 0; i < 6; i++) {
        K[i] = KL[i][0] * powf(L0, 3) + KL[i][1] * powf(L0, 2) + KL[i][2] * powf(L0, 1) + KL[i][3] * powf(L0, 0);
    }
}